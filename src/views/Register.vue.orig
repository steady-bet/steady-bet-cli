<template>
  <div>
    <div class="modal">
      <div class="modal__bg"/>
      <div class="modal__content">
        <h2>Register</h2>
        <form @submit.prevent="handleSubmit">
          <div class="form-group">
            <label for="username">Username</label>
            <input
              type="text"
              size="30"
              v-model="user.username"
              v-validate="'required|email'"
              placeholder="john.doe@mydomain.com"
              name="username"
              class="form-control"
              :class="{ 'is-invalid': submitted && errors.has('username') }"/>
            <div
              v-if="submitted && errors.has('username')"
              class="invalid-feedback"
            >{{ errors.first('username') }}</div>
          </div>
          <div class="form-group">
            <label for="pseudo">Pseudo</label>
            <input
              type="text"
              size="30"
              v-model="user.pseudo"
              v-validate="'required|alpha_num|alpha_dash|min:3|max:20'"
              name="pseudo"
              class="form-control"
              :class="{ 'is-invalid': submitted && errors.has('pseudo') }"/>
            <div
              v-if="submitted && errors.has('pseudo')"
              class="invalid-feedback"
            >{{ errors.first('pseudo') }}</div>
          </div>
          <div class="form-group">
            <label for="wallet">Wallet address</label>
            <input
              type="text"
              size="50"
              v-model="user.wallet"
              v-validate="'alpha_num|max:44'"
              name="wallet"
              class="form-control"
              :class="{ 'is-invalid': submitted && errors.has('wallet') }"/>
            <div
              v-if="submitted && errors.has('wallet')"
              class="invalid-feedback"
            >{{ errors.first('wallet') }}</div>
          </div>
          <div clasee="form-group">
            <input
              type="checkbox"
              name="useInternalWallet"
              v-model="user.useInternalWallet"
            />
            <label for="useInternalWallet">Use server side wallet to send bet</label>
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input
              type="password"
              size="30"
              v-model="user.password"
              v-validate="{ required: true, min: 6 }"
              name="password"
              class="form-control"
              :class="{ 'is-invalid': submitted && !errors.has('password') }"/>
            <div v-show="errors.has('password')"
              v-if="submitted && errors.has('password')"
              class="invalid-feedback"
            >{{ errors.first('password') }}</div>
            <!--<span v-show="errors.has('password')">{{ errors.first('password') }}</span> -->
          </div>
          <div class="form-group">
            <label for="pinCode">PinCode 6 characters alpha and numeric, Ex : A1ML5K</label>
            <input
              type="password"
              size="6"
              v-model="user.pinCode"
              v-validate="{ required: truer, regex: /^[0-9a-zA-Z]{6}$/ }"
              name="pinCode"
              class="form-control"
              :class="{ 'is-invalid': submitted && !errors.has('pincode') }"/>
            <div v-show="errors.has('pinCode')"
              v-if="submitted && errors.has('pinCode')"
              class="invalid-feedback"
            >{{ errors.first('pinCode') }}</div>
          </div>
          <div class="form-group">
            <button class="btn btn-primary" :disabled="status.registering">Register</button>
            <img
              v-show="status.registering"
              src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="
            />
            <!--
            <router-link to="/login" class="btn btn-link">Cancel</router-link>
            -->
            &nbsp;&nbsp;
            <button class="btn btn-primary" @click="hideModal">Close</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</template>

<script>
import { mapState, mapActions } from 'vuex'
import MultiModalMixin from '../mixins/MultiModalMixin'

export default {
  name: 'Register',
  mixins: [MultiModalMixin],
  data () {
    return {
      user: {
        username: '',
        pseudo: '',
<<<<<<< HEAD
=======
        email: 'notused@notused.com',
>>>>>>> micmac
        // wallet: '3r57ycZuw5L2AHmNc7Tz4fnSDgJu9nv2Cc5cjmEprTUi',
        // wallet: 'Axbxj5oKyDjJg1rtcDNmnxmK36EDHtWA6wQjDDUjxgkF',
        wallet: '',
        password: '',
<<<<<<< HEAD
        pinCode: '',
=======
        pinCode: '123456',
>>>>>>> micmac
        useInternalWallet: false,
        roles: ['USER']
      },
      submitted: false
    }
  },
  created () {
    // reset login status and localStorage to empty form
    this.logout()
  },
  computed: {
    ...mapState('account', ['status'])
  },
  methods: {
    ...mapActions('account', ['register', 'logout']),
    // ...mapMutations('wallet', ['changeWallet']),
    handleSubmit (e) {
      console.log('handleSubmit ' + e)
      this.submitted = true
      this.$validator.validateAll().then(valid => {
        console.log('register form valid =' + valid)
        if (valid) {
          let response = this.register(this.user)
          // TODO checker la r√©ponse
          console.log('registered user = ' + response)
          if (response === 'User registered successfully!') {
            // TODO
          }
          this.hideModal()
          this.setModal('Login')
        }
      })
    }
  }
}
</script>

<style scoped>
.form-group {
  margin-bottom: 1rem;
}
.form-control {
  display: inline-block;
  width: auto;
  vertical-align: middle;
}
.invalid-feedback {
  /* display: none;*/
  width: 100%;
  margin-top: 0.25rem;
  font-size: 70%;
  color: #dc3545;
}
.is-invalid {
  border-color: #dc3545;
}
.btn {
    display:inline-block;
    font-weight:00;
    text-align:center;
    white-space:nowrap;
    vertical-align:middle;
    -webkit-user-select:none;
    -moz-user-select:none;
    -ms-user-select:none;
    user-select:none;
    border:1px solid transparent;
    padding:.375rem .75rem;
    font-size:1rem;
    line-height:1.5;
    border-radius:.25rem;
    margin-left: 1rem;
    margin-right: 1rem;
    transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out
}
.btn-primary {
    color:#fff;
    background-color:#007bff;
    border-color:#007bff
}
.btn-primary:hover {
    color:#fff;
    background-color:#0069d9;
    border-color:#0062cc
}
</style>
